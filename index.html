<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            user-select: none;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .option-btn {
            border: 1px solid #d1d5db;
            text-align: left;
            width: 100%;
            background-color: white;
            padding: 0.75rem 1.25rem;
        }
        .option-btn:hover {
            background-color: #f9fafb;
        }
        .option-btn.selected {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            font-weight: 500;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">

    <div id="main-container" class="w-full max-w-4xl mx-auto">
        <!-- Login Screen -->
        <div id="login-screen" class="card text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Exam Simulator</h1>
            <p class="text-gray-600 mb-6">Enter the password from your book to access.</p>
            <div class="max-w-sm mx-auto">
                <input type="password" id="password-input" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Password">
                <button id="login-btn" class="btn btn-primary w-full">Login</button>
                <p id="error-message" class="text-red-500 mt-4 h-5"></p>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="card text-center hidden">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Welcome!</h1>
            <p class="text-gray-600 mb-8">Choose your preferred simulation mode.</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="startTest('veloce')" class="btn btn-primary flex-1">
                    <span class="block text-lg">Quick Test</span>
                    <span class="block text-sm font-normal">50 questions - 1 hour</span>
                </button>
                <button onclick="startTest('completo')" class="btn btn-secondary flex-1 border border-gray-300">
                    <span class="block text-lg">Full Test</span>
                    <span class="block text-sm font-normal">100 questions - 2.5 hours</span>
                </button>
            </div>
        </div>

        <!-- Exam Screen -->
        <div id="exam-screen" class="card hidden">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 id="question-counter" class="text-xl font-semibold text-gray-700">Question 1 of 50</h2>
                <div id="timer" class="text-2xl font-bold text-indigo-600 bg-indigo-100 px-4 py-2 rounded-lg">60:00</div>
            </div>
            
            <div class="mb-6">
                <p id="question-text" class="text-lg text-gray-800 leading-relaxed"></p>
            </div>

            <div id="options-container" class="space-y-3 mb-8">
                <!-- Options will be dynamically inserted here -->
            </div>

            <div class="flex justify-between items-center">
                <button onclick="skipQuestion()" class="btn btn-secondary">Skip</button>
                <button onclick="nextQuestion()" class="btn btn-primary">Next</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="card text-center hidden">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Simulation Complete!</h1>
            <div id="result-badge" class="mb-6">
                <!-- Pass/Fail result will be inserted here -->
            </div>
            <p class="text-gray-600 mb-2">Your score is:</p>
            <p id="score" class="text-6xl font-bold text-indigo-600 mb-4"></p>
            <p id="score-details" class="text-gray-700 mb-8"></p>

            <div class="flex justify-center gap-4">
                <button id="review-btn" onclick="toggleReview()" class="btn btn-secondary hidden">Review Incorrect Answers</button>
                <button onclick="restart()" class="btn btn-primary">Try another test</button>
            </div>

            <div id="review-container" class="mt-8 text-left hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Review Your Answers</h2>
                <div id="review-content" class="space-y-6 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border">
                    <!-- Incorrect answers will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const CORRECT_PASSWORD = 'zaqw'; // Access password

        // --- QUESTIONS DATABASE ---
        // Ho integrato un numero molto maggiore di domande per garantire la variet√†.
        const allQuestions = [
            // Block 1
            { question: "What is the primary purpose of a real estate license?", options: ["To guarantee sales success", "To regulate and protect the public in real estate transactions", "To increase property values", "To limit competition in the market"], answer: "To regulate and protect the public in real estate transactions" },
            { question: "Which of the following is NOT typically required to obtain a real estate license?", options: ["Completing pre-license education", "Passing a state exam", "Having a college degree", "Being at least 18 years old"], answer: "Having a college degree" },
            { question: "A real estate salesperson can work independently without broker supervision.", options: ["True", "False"], answer: "False" },
            { question: "Which agency relationship requires the highest level of fiduciary duty?", options: ["Customer relationship", "Client relationship", "Transactional relationship", "Dual agency relationship"], answer: "Client relationship" },
            { question: "Dual agency is legal in all states.", options: ["True", "False"], answer: "False" },
            { question: "Which of the following is NOT a fiduciary duty?", options: ["Loyalty", "Disclosure", "Guarantee of sale", "Confidentiality"], answer: "Guarantee of sale" },
            { question: "An agent must disclose known material defects to potential buyers.", options: ["True", "False"], answer: "True" },
            { question: "Which listing type allows the seller to sell the property themselves without paying commission?", options: ["Exclusive right to sell", "Exclusive agency", "Open listing", "Net listing"], answer: "Exclusive agency" },
            { question: "Net listings are illegal in most states.", options: ["True", "False"], answer: "True" },
            { question: "What is the purpose of the Multiple Listing Service (MLS)?", options: ["To set property prices", "To facilitate cooperation between brokers", "To replace real estate agents", "To provide legal advice"], answer: "To facilitate cooperation between brokers" },
            { question: "What is a CMA (Comparative Market Analysis)?", options: ["A formal appraisal", "An informal estimate of property value", "A marketing plan", "A legal document"], answer: "An informal estimate of property value" },
            { question: "A CMA can be used in place of a formal appraisal for lending purposes.", options: ["True", "False"], answer: "False" },
            { question: "What are the four elements of value?", options: ["Demand, utility, scarcity, transferability", "Location, size, age, condition", "Price, terms, condition, timing", "Supply, demand, cost, profit"], answer: "Demand, utility, scarcity, transferability" },
            { question: "The highest and best use of a property always generates the most income.", options: ["True", "False"], answer: "False" },
            { question: "Which appraisal approach is most appropriate for unique properties?", options: ["Cost approach", "Sales comparison approach", "Income approach", "All approaches equally"], answer: "Cost approach" },
            { question: "Depreciation only applies to buildings, not land.", options: ["True", "False"], answer: "True" },
            { question: "What does 'arm's length transaction' mean?", options: ["A transaction between relatives", "A transaction between unrelated parties", "A transaction requiring legal representation", "A transaction involving multiple properties"], answer: "A transaction between unrelated parties" },
            { question: "A property sold under duress represents fair market value.", options: ["True", "False"], answer: "False" },
            { question: "What is the purpose of a property disclosure statement?", options: ["To set the selling price", "To inform buyers of known defects", "To guarantee the property condition", "To replace a professional inspection"], answer: "To inform buyers of known defects" },
            { question: "Which document provides constructive notice of ownership?", options: ["Purchase agreement", "Deed", "Title insurance policy", "Survey"], answer: "Deed" },
            { question: "What is the purpose of title insurance?", options: ["To guarantee property value", "To protect against title defects", "To replace a title search", "To provide liability coverage"], answer: "To protect against title defects" },
            { question: "Title insurance premiums are paid annually.", options: ["True", "False"], answer: "False" },
            { question: "Which deed provides the greatest protection to the grantee?", options: ["Quitclaim deed", "Special warranty deed", "General warranty deed", "Bargain and sale deed"], answer: "General warranty deed" },
            { question: "A quitclaim deed guarantees that the grantor owns the property.", options: ["True", "False"], answer: "False" },
            { question: "What happens to a joint tenant's interest when they die?", options: ["It passes to their heirs", "It transfers to surviving joint tenants", "It becomes part of their estate", "It reverts to the state"], answer: "It transfers to surviving joint tenants" },
            { question: "What is an easement?", options: ["A type of ownership", "A right to use another's property", "A form of lease", "A property restriction"], answer: "A right to use another's property" },
            { question: "What is eminent domain?", options: ["The right to exclude others from property", "Government's right to take private property for public use", "The right to lease property", "The right to sell property"], answer: "Government's right to take private property for public use" },
            { question: "Property owners must be compensated when government takes their property through eminent domain.", options: ["True", "False"], answer: "True" },
            { question: "What is escheat?", options: ["Property transfer to government when owner dies without heirs", "Government taking for public use", "Property tax collection", "Zoning regulation"], answer: "Property transfer to government when owner dies without heirs" },
            { question: "Which of the following is considered real property?", options: ["Furniture", "Trade fixtures", "Built-in appliances", "Clothing"], answer: "Built-in appliances" },
            { question: "What is a fee simple absolute estate?", options: ["The highest form of property ownership", "A leasehold interest", "A life estate", "An easement"], answer: "The highest form of property ownership" },
            { question: "Under the Statute of Frauds, which leases must be in writing?", options: ["All leases", "Leases over one year", "Month-to-month leases", "Commercial leases only"], answer: "Leases over one year" },
            { question: "Security deposits can be used for normal wear and tear.", options: ["True", "False"], answer: "False" },
            { question: "What is a sale-leaseback transaction?", options: ["Selling property then leasing it back", "Buying property through lease payments", "Converting lease to ownership", "Terminating lease early"], answer: "Selling property then leasing it back" },
            
            // Block 2
            { question: "Which of the following is NOT one of the fiduciary duties remembered by O.L.D. C.A.R.?", options: ["Obedience", "Loyalty", "Guarantee", "Confidentiality"], answer: "Guarantee" },
            { question: "An agent's fiduciary duty of confidentiality ends when the listing expires.", options: ["True", "False"], answer: "False" },
            { question: "Which duty requires an agent to follow all lawful instructions from their client?", options: ["Loyalty", "Disclosure", "Obedience", "Accounting"], answer: "Obedience" },
            { question: "An agent must disclose all material facts to all parties in a transaction.", options: ["True", "False"], answer: "True" },
            { question: "When must agency relationships be disclosed to parties in a transaction?", options: ["At first substantial contact", "Before writing an offer", "At closing", "Only if asked"], answer: "At first substantial contact" },
            { question: "What does 'procuring cause' mean in real estate?", options: ["The reason the property was listed", "The agent whose efforts were the primary reason a transaction occurred", "The legal cause for contract termination", "The primary motivation of the buyer"], answer: "The agent whose efforts were the primary reason a transaction occurred" },
            { question: "Which covenant in a general warranty deed protects against unknown encumbrances?", options: ["Covenant of seisin", "Covenant against encumbrances", "Covenant of quiet enjoyment", "Covenant of warranty"], answer: "Covenant against encumbrances" },
            { question: "A deed must be recorded to be valid between grantor and grantee.", options: ["True", "False"], answer: "False" },
            { question: "What is marketable title?", options: ["Title that is guaranteed to increase in value", "Title that is reasonably free from defects and acceptable to a prudent buyer", "Title held by a famous person", "A new form of digital title"], answer: "Title that is reasonably free from defects and acceptable to a prudent buyer" },
            { question: "A property sells for $400,000 with a 6% commission split equally between listing and selling agents. If the selling agent has a 80/20 split with their broker, what does the agent receive?", options: ["$12,000", "$9,600", "$24,000", "$4,800"], answer: "$9,600" },
            { question: "A buyer pays 2 discount points on a $250,000 loan. How much do the points cost?", options: ["$2,500", "$5,000", "$7,500", "$10,000"], answer: "$5,000" },
            { question: "When is PMI typically required on conventional loans?", options: ["When LTV exceeds 90%", "When LTV exceeds 85%", "When LTV exceeds 80%", "When LTV exceeds 75%"], answer: "When LTV exceeds 80%" },
            { question: "Which loan program allows 100% financing with no down payment?", options: ["FHA", "VA", "Conventional", "USDA"], answer: "VA" },
            { question: "Which RESPA section prohibits kickbacks and referral fees?", options: ["Section 6", "Section 8", "Section 10", "Section 12"], answer: "Section 8" },
            { question: "What does APR stand for and represent?", options: ["Annual Percentage Rate - the true cost of credit", "Adjusted Payment Rate - the modified payment amount", "Average Principal Rate - the mean interest charged", "Actual Purchase Rate - the final loan rate"], answer: "Annual Percentage Rate - the true cost of credit" },
            { question: "What is redlining in the context of fair housing?", options: ["Drawing red lines on a map to indicate sales territories", "The illegal practice of refusing services to entire neighborhoods based on racial composition", "A marketing technique for luxury properties", "A type of interior design"], answer: "The illegal practice of refusing services to entire neighborhoods based on racial composition" },

            // Block 3
            { question: "What are the four unities required for joint tenancy (P.I.T.T.)?", options: ["Possession, Interest, Title, Trust", "Possession, Interest, Time, Title", "Property, Interest, Time, Trust", "Price, Interest, Time, Title"], answer: "Possession, Interest, Time, Title" },
            { question: "Which leasehold estate has a definite beginning and ending date?", options: ["Estate for years", "Periodic tenancy", "Estate at will", "Estate at sufferance"], answer: "Estate for years" },
            { question: "What is constructive eviction?", options: ["A legal process to formally evict a tenant", "When a tenant is physically removed by the landlord", "When landlord's actions make property uninhabitable, forcing tenant to leave", "When a tenant evicts the landlord"], answer: "When landlord's actions make property uninhabitable, forcing tenant to leave" },
            { question: "Which of the following is NOT a protected class under federal fair housing law?", options: ["Race", "Religion", "Sexual orientation", "Familial status"], answer: "Sexual orientation" },
            { question: "Which practice involves inducing property owners to sell by suggesting that minority groups entering the area will lower property values?", options: ["Steering", "Blockbusting", "Redlining", "Price fixing"], answer: "Blockbusting" },
            { question: "The Americans with Disabilities Act (ADA) applies to residential housing transactions.", options: ["True", "False"], answer: "False" },
            { question: "What is specific performance in contract law?", options: ["A remedy requiring a party to pay damages", "A remedy requiring the breaching party to perform exactly as contracted", "A court order to perform a specific act of community service", "The act of performing a contract on time"], answer: "A remedy requiring the breaching party to perform exactly as contracted" },
            { question: "What is the difference between void and voidable contracts?", options: ["There is no difference", "Void contracts are illegal, voidable contracts are not", "Void contracts have no legal effect; voidable contracts can be canceled by one party", "Void contracts are verbal, voidable contracts are written"], answer: "Void contracts have no legal effect; voidable contracts can be canceled by one party" },
            { question: "One acre contains 43,560 square feet.", options: ["True", "False"], answer: "True" },
            { question: "What does a mill represent in property taxation?", options: ["$1 per $100 of assessed value", "$1 per $1,000 of assessed value", "$10 per $1,000 of assessed value", "1% of assessed value"], answer: "$1 per $1,000 of assessed value" },
            { question: "What is the formula for calculating capitalization rate?", options: ["Property Value / NOI", "NOI / Property Value", "Gross Income / Property Value", "NOI / Gross Income"], answer: "NOI / Property Value" },
            { question: "Mortgage payments are included in calculating NOI.", options: ["True", "False"], answer: "False" },
            { question: "What is an adjustable rate mortgage (ARM)?", options: ["A mortgage with a fixed interest rate for the entire term", "A mortgage with interest rates that change periodically based on market conditions", "A loan for purchasing adjustable furniture", "A government-insured mortgage"], answer: "A mortgage with interest rates that change periodically based on market conditions" },
            { question: "A 5/1 ARM has a fixed rate for 5 years, then adjusts annually.", options: ["True", "False"], answer: "True" },
            { question: "What is the purpose of errors and omissions (E&O) insurance?", options: ["To protect against claims arising from professional negligence or mistakes", "To cover property damage", "To insure against employee theft", "To provide health insurance for agents"], answer: "To protect against claims arising from professional negligence or mistakes" },
            
            // Block 4
            { question: "What is a variance in zoning law?", options: ["A change in the master plan", "Permission to use property in a way that differs from zoning requirements due to unique hardship", "A temporary permit for construction", "A type of property tax"], answer: "Permission to use property in a way that differs from zoning requirements due to unique hardship" },
            { question: "Which government power allows taking private property for public use?", options: ["Police power", "Eminent domain", "Taxation", "Escheat"], answer: "Eminent domain" },
            { question: "Private deed restrictions can be more restrictive than public zoning ordinances.", options: ["True", "False"], answer: "True" },
            { question: "What is an easement appurtenant?", options: ["An easement that benefits a utility company", "An easement that is personal and not tied to land", "An easement that benefits a specific parcel of land (dominant tenement)", "An easement created by court order"], answer: "An easement that benefits a specific parcel of land (dominant tenement)" },
            { question: "Utility easements are typically easements in gross.", options: ["True", "False"], answer: "True" },
            { question: "In the cost approach, what does 'reproduction cost' mean?", options: ["The cost to build a similar property with modern materials", "The cost to build an exact replica using identical materials and methods", "The original cost of the property", "The market value of the property"], answer: "The cost to build an exact replica using identical materials and methods" },
            { question: "Which type of depreciation results from factors outside the property boundaries?", options: ["Physical deterioration", "Functional obsolescence", "External obsolescence", "Economic depreciation"], answer: "External obsolescence" },
            { question: "Land never depreciates in the cost approach to value.", options: ["True", "False"], answer: "True" },
            { question: "What is reconciliation in the appraisal process?", options: ["The process of averaging the values from the three approaches", "The process of weighing different value indications to arrive at a final estimate", "A meeting between the appraiser and the borrower", "The final step in getting an appraisal license"], answer: "The process of weighing different value indications to arrive at a final estimate" },
            { question: "In a land contract (contract for deed), who holds legal title during the payment period?", options: ["The buyer (vendee)", "The seller (vendor)", "A neutral third party", "Both parties jointly"], answer: "The seller (vendor)" },
            { question: "A counteroffer rejects the original offer and creates a new one.", options: ["True", "False"], answer: "True" },
            { question: "What is the purpose of earnest money in a real estate transaction?", options: ["To pay the real estate agent's commission", "To demonstrate buyer's serious intent and provide some security to the seller", "It is a mandatory federal fee", "To cover the cost of the appraisal"], answer: "To demonstrate buyer's serious intent and provide some security to the seller" },
            { question: "What is a contingency clause in a real estate contract?", options: ["A clause that details the agent's commission", "A condition that must be satisfied for the contract to be binding", "A section outlining the property's history", "A penalty for backing out of the contract"], answer: "A condition that must be satisfied for the contract to be binding" },
            { question: "Which professional can provide formal appraisals for mortgage lending purposes?", options: ["Real estate agents", "Real estate brokers", "Licensed or certified appraisers", "Anyone with real estate experience"], answer: "Licensed or certified appraisers" },
            { question: "What is the purpose of real estate licensing laws?", options: ["To protect the public by ensuring real estate professionals meet minimum competency standards", "To limit the number of agents in the market", "To generate revenue for the state", "To ensure all agents make a minimum income"], answer: "To protect the public by ensuring real estate professionals meet minimum competency standards" },
            
            // Block 5
            { question: "What is the maximum penalty for a first-time fair housing violation?", options: ["$10,000", "$16,000", "$37,000", "$65,000"], answer: "$16,000" },
            { question: "Service animals are exempt from 'no pets' policies in rental housing.", options: ["True", "False"], answer: "True" },
            { question: "Which agency enforces federal fair housing laws?", options: ["Federal Trade Commission", "Department of Housing and Urban Development", "Equal Employment Opportunity Commission", "Department of Justice"], answer: "Department of Housing and Urban Development" },
            { question: "Fair housing complaints must be filed within one year of the alleged violation.", options: ["True", "False"], answer: "True" },
            { question: "What is the closing process also known as?", options: ["Escrow", "Settlement", "Both A and B", "Neither A nor B"], answer: "Both A and B" },
            { question: "What is the purpose of the final walkthrough?", options: ["To conduct a home inspection", "To verify property condition hasn't changed", "To determine final purchase price", "To obtain keys from sellers"], answer: "To verify property condition hasn't changed" },
            { question: "When must the Closing Disclosure be provided to borrowers?", options: ["At least one business day before closing", "At least three business days before closing", "At least five business days before closing", "On the day of closing"], answer: "At least three business days before closing" },
            { question: "Cash transactions are subject to TRID disclosure requirements.", options: ["True", "False"], answer: "False" },
            
            // Block 6
            { question: "How many sections are in a township?", options: ["24", "36", "48", "64"], answer: "36" },
            { question: "A section contains how many square miles?", options: ["1 square mile", "2 square miles", "4 square miles", "6 square miles"], answer: "1 square mile" },
            { question: "Which legal description method is most commonly used for new subdivisions?", options: ["Metes and bounds", "Rectangular survey", "Lot and block", "Any method can be used"], answer: "Lot and block" },
            { question: "Street addresses are sufficient legal descriptions for deed purposes.", options: ["True", "False"], answer: "False" },
            { question: "Tax liens have priority over mortgage liens.", options: ["True", "False"], answer: "True" },
            { question: "Which type of depreciation is always incurable?", options: ["Physical deterioration", "Functional obsolescence", "External obsolescence", "None are always incurable"], answer: "External obsolescence" },
            { question: "What is a broker price opinion (BPO)?", options: ["A formal appraisal of a property", "A real estate professional's opinion of property value, less formal than an appraisal", "The price a broker thinks a property should be listed at", "A binding offer price from a broker"], answer: "A real estate professional's opinion of property value, less formal than an appraisal" },
            { question: "What is a short sale in real estate?", options: ["A quick cash sale of a property", "Sale of property for less than the outstanding mortgage balance with lender approval", "A sale that takes less than 30 days to close", "A foreclosure auction"], answer: "Sale of property for less than the outstanding mortgage balance with lender approval" },
            { question: "A deed in lieu of foreclosure is a voluntary transfer of property deed to lender to satisfy mortgage debt.", options: ["True", "False"], answer: "True" },
            { question: "What is an REO property?", options: ["Real Estate Office", "Real Estate Owned - property acquired by lenders through foreclosure", "Rental Equity Opportunity", "A type of commercial property"], answer: "Real Estate Owned - property acquired by lenders through foreclosure" }
        ];
        

        // --- STATE VARIABLES ---
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let mainQueue = [];
        let skippedQueue = new Set();
        let timerInterval;
        let timeRemaining = 0;
        let questionsAttempted = 0;
        
        // --- DOM REFERENCES ---
        const loginScreen = document.getElementById('login-screen');
        const homeScreen = document.getElementById('home-screen');
        const examScreen = document.getElementById('exam-screen');
        const resultsScreen = document.getElementById('results-screen');
        const passwordInput = document.getElementById('password-input');
        const loginBtn = document.getElementById('login-btn');
        const errorMessage = document.getElementById('error-message');
        const reviewBtn = document.getElementById('review-btn');
        const reviewContainer = document.getElementById('review-container');

        // --- SCREEN MANAGEMENT ---
        function showScreen(screenId) {
            [loginScreen, homeScreen, examScreen, resultsScreen].forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // --- LOGIN LOGIC ---
        loginBtn.addEventListener('click', () => {
            if (passwordInput.value === CORRECT_PASSWORD) {
                showScreen('home-screen');
                errorMessage.textContent = '';
            } else {
                errorMessage.textContent = 'Incorrect password. Please try again.';
                passwordInput.focus();
            }
        });
        passwordInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                loginBtn.click();
            }
        });

        // --- EXAM LOGIC ---
        function startTest(type) {
            reviewContainer.classList.add('hidden');
            reviewBtn.classList.add('hidden');
            const isFastTest = type === 'veloce';
            const questionCount = isFastTest ? 50 : 100;
            const durationInSeconds = isFastTest ? 60 * 60 : 150 * 60;

            currentQuestions = [...allQuestions].sort(() => 0.5 - Math.random()).slice(0, questionCount);
            
            userAnswers = new Array(questionCount).fill(null);
            mainQueue = Array.from({length: questionCount}, (_, i) => i);
            skippedQueue.clear();
            questionsAttempted = 0;

            loadNextQuestionFromQueues();
            startTimer(durationInSeconds);
            showScreen('exam-screen');
        }

        function loadNextQuestionFromQueues() {
            if (mainQueue.length > 0) {
                currentQuestionIndex = mainQueue.shift();
                displayQuestion();
            } else if (skippedQueue.size > 0) {
                const skippedArray = Array.from(skippedQueue);
                currentQuestionIndex = skippedArray[0];
                skippedQueue.delete(currentQuestionIndex);
                displayQuestion();
            } else {
                endTest();
            }
        }

        function displayQuestion() {
            questionsAttempted++;
            const questionData = currentQuestions[currentQuestionIndex];
            document.getElementById('question-counter').textContent = `Question ${questionsAttempted} of ${currentQuestions.length}`;
            document.getElementById('question-text').textContent = questionData.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            questionData.options.forEach(option => {
                const optionEl = document.createElement('button');
                optionEl.textContent = option;
                optionEl.className = 'btn option-btn';
                if (userAnswers[currentQuestionIndex] === option) {
                    optionEl.classList.add('selected');
                }
                optionEl.onclick = () => selectAnswer(option, optionEl);
                optionsContainer.appendChild(optionEl);
            });
        }
        
        function selectAnswer(option, element) {
            userAnswers[currentQuestionIndex] = option;
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function nextQuestion() {
            if (userAnswers[currentQuestionIndex] === null) {
                skippedQueue.add(currentQuestionIndex);
            } else {
                // If an answer was provided, remove it from the skipped queue in case it was there before
                skippedQueue.delete(currentQuestionIndex);
            }
            loadNextQuestionFromQueues();
        }

        function skipQuestion() {
            skippedQueue.add(currentQuestionIndex);
            loadNextQuestionFromQueues();
        }

        function startTimer(duration) {
            clearInterval(timerInterval);
            timeRemaining = duration;
            const timerEl = document.getElementById('timer');

            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining <= 0) {
                    timerEl.textContent = "00:00";
                    endTest();
                }
            }, 1000);
        }

        function endTest() {
            clearInterval(timerInterval);
            calculateAndShowResults();
            showScreen('results-screen');
        }

        function calculateAndShowResults() {
            let correctAnswers = 0;
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = '';
            let hasIncorrectAnswers = false;
            let questionNumber = 1;

            currentQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                if (q.answer === userAnswer) {
                    correctAnswers++;
                } else {
                    hasIncorrectAnswers = true;
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'p-4 border-b last:border-b-0';
                    reviewItem.innerHTML = `
                        <p class="font-semibold text-gray-800 mb-2">${questionNumber}. ${q.question}</p>
                        <p class="text-red-600">Your answer: <span class="font-medium">${userAnswer || 'Not answered'}</span></p>
                        <p class="text-green-600">Correct answer: <span class="font-medium">${q.answer}</span></p>
                    `;
                    reviewContent.appendChild(reviewItem);
                    questionNumber++;
                }
            });

            if (hasIncorrectAnswers) {
                reviewBtn.classList.remove('hidden');
            } else {
                reviewBtn.classList.add('hidden');
                reviewContent.innerHTML = `<p class="text-center text-gray-600 p-4">Great job! No incorrect answers to review.</p>`;
            }

            const scorePercentage = Math.round((correctAnswers / currentQuestions.length) * 100);
            const passed = scorePercentage >= 75;

            document.getElementById('score').textContent = `${scorePercentage}%`;
            document.getElementById('score-details').textContent = `You answered ${correctAnswers} questions correctly out of ${currentQuestions.length}.`;
            
            const resultBadge = document.getElementById('result-badge');
            if (passed) {
                resultBadge.innerHTML = `<span class="inline-block bg-green-100 text-green-800 text-lg font-semibold px-6 py-2 rounded-full">PASS</span>`;
            } else {
                resultBadge.innerHTML = `<span class="inline-block bg-red-100 text-red-800 text-lg font-semibold px-6 py-2 rounded-full">FAIL</span>`;
            }
        }

        function toggleReview() {
            reviewContainer.classList.toggle('hidden');
            reviewBtn.textContent = reviewContainer.classList.contains('hidden') ? 'Review Incorrect Answers' : 'Hide Review';
        }
        
        function restart() {
            showScreen('home-screen');
        }

    </script>
</body>
</html>
